import{loadGameplayModules}from"../constants/gameplay.js";import{version}from"/constants/version.js";async function loadConstants(){const{themes:t}=await import(`../constants/settings.min.js?${version}`);return{themes:t}}async function loadHelpers(){const{SaveData:t,GetData:e,RemoveData:s,ClearStore:i}=await import(`../helpers/db-helper.min.js?${version}`);return{SaveData:t,GetData:e,RemoveData:s,ClearStore:i}}async function LoadAllModules(){const t=await loadGameplayModules();return{...await loadHelpers(version),...await loadConstants(version),...t}}Vue.config.devtools=!1,Vue.config.debug=!1,Vue.config.silent=!0,Vue.config.ignoredElements=["app","page","navbar","settings","splash","splashwrap","message","notifications","speedControls","state","bank","commodity","detail","gameover","listheader","listings","category","name","units","currentPrice","description","market","currentValue","contractSize","goldbacking","contractUnit"],LoadAllModules().then((t=>{window.app=new Vue({el:"#app",data:()=>({version:version,isLoading:!1,isDropping:!1,isStopped:!0,isReady:!1,useDarkPuck:!1,lastUpdate:null,isSuccess:!1,isPlaying:!1,stageScale:1,campaigns:t.campaigns,currentCampaign:null,currentSet:null,currentStage:null,previousCampaign:null,previousSet:null,previousStage:null,puckX:0,puckY:0,puckWidth:20,puckHeight:10,goodGradeThreshold:84,trailWidth:20,trailHeight:10,targetX:0,targetY:0,targetWidth:500,targetHeight:100,speed:6,dropMaxCount:3,dropCount:0,dropTotalCount:0,startingDropCount:UseDebug?5:20,score:0,lock:!1,showInstructions:!0,showHome:!0,showEndSet:!0,spaceBarCooldown:!1,showSettings:!1,showYesNo:!1,showSets:!1,showCampaigns:!1,showInterstitial:!1,showAnnouncement:!0,hasUsedSpaceBar:!1,spaceBarInUse:!1,results:[],difficulties:t.difficulties,currentDifficulty:t.difficulties[0],themes:t.themes,grades:t.grades,resizeDebounceTimer:null,stageElement:document.getElementsByTagName("stage")[0],puckElement:document.getElementsByTagName("puck")[0],r:document.querySelector(":root"),c:window.getComputedStyle(document.querySelector(":root"))}),methods:{CompleteStageAndReadyNext(){note("Ready stage"),this.RemoveConfetti();let e=this.stageElement.getBoundingClientRect();const s=this.currentCampaign.isEndless;this.isSuccess&&(this.currentStage.finished=!0),this.isSuccess=!1,this.puckY=-this.puckHeight-2;if(this.currentStage.finished||this.dropCount>=this.dropMaxCount){if(this.results.length>0){const t=this.results[this.results.length-1];this.currentStage.success=t.success,this.currentStage.attempts=t.attempts}s||(this.QueueSet(),this.SelectDifficulty(this.currentStage.difficulty)),this.puckY=-this.puckHeight-2,this.puckX=s?getRandomInt(this.puckWidth/2,e.width-this.puckWidth/2):this.currentStage.kx,this.targetHeight=s?getRandomInt(20,100):this.currentStage.th,this.targetY=s?getRandomInt(100+this.puckHeight,e.height-this.targetHeight):this.currentStage.ty,this.dropCount=0,this.results.push(new t.ResultModel({count:this.dropTotalCount,difficulty:this.currentDifficulty.name}))}s&&window.innerHeight-e.y-this.targetY-this.targetHeight-2<100&&(log("Adjusting target Y position for first run"),this.targetY=e.height-this.targetHeight-100)},QueueSet(){if(note("Queue set"),this.currentSet=this.currentCampaign.sets.find((t=>!t.finished)),!this.currentSet)return note("All sets complete!"),void this.currentCampaign.sets.forEach((t=>{t.locked=!1}));this.currentSet.locked=!1;0===this.currentSet.stages.filter((t=>!t.finished)).length?(this.currentSet.finished=!0,this.QueueSet()):this.QueueStage()},QueueStage(){note("Queue stage"),this.currentStage=this.currentSet.stages.find((t=>!t.finished))||this.currentSet.stages[0]},QueueCampaign(){note("Queue campaign");let t=this.campaigns.findIndex((t=>t.selected));if(-1===t)return this.currentCampaign=this.campaigns[0],void(this.currentCampaign.selected=!0);this.campaigns[t].isEndless||(t!==this.campaigns.length-1?this.currentCampaign=this.campaigns[t+1]:this.currentCampaign=this.campaigns[0])},ReadyCampaign(t){},StopPuck(){note("Stopping puck");const t=window.getComputedStyle(this.puckElement).transform.match(/matrix.*\((.+)\)/)[1].split(", ");this.puckY=t[5];let e=this.score+this.targetValue;const s=Number(this.puckY)+Number(this.puckHeight),i=Number(this.targetY),n=Number(this.targetY)+Number(this.targetHeight);s>=i-2&&s<=n+2&&(this.score=e,this.isSuccess=!0,this.currentStage.finished=!0),this.currentCampaign.isEndless||3!==this.dropCount||this.isSuccess||(this.currentStage.finished=!0);let a=this.results[this.results.length-1];if(Number(this.puckY)+Number(this.puckHeight)+1>Number(this.targetHeight)+Number(this.targetY)+2?a.deltas.push(Number(this.targetHeight)+Number(this.targetY)+2-Number(this.puckY)+Number(this.puckHeight)+1):Number(this.puckY)+Number(this.puckHeight)+1<Number(this.targetY)&&a.deltas.push(Number(this.puckY)+Number(this.puckHeight)+1-Number(this.targetY)),a.attempts=this.dropCount,a.success=this.isSuccess,a.value=e,a.speed=this.currentDifficulty.speed,a.py=this.puckY,a.px=this.puckX,a.ph=this.puckHeight,a.pw=this.puckWidth,a.ty=this.targetY,a.th=this.targetHeight,a.tw=this.targetWidth,this.dropTotalCount++,!this.currentCampaign.isEndless&&this.IsSetComplete(this.currentSet)){note("Set complete, Unlocking next set"),this.lock=!0,this.currentSet.finished=!0,this.showEndSet=!0,this.UnlockNextSet(this.currentCampaign,this.currentSet),this.IsCampaignComplete(this.currentCampaign)&&(this.currentCampaign.finished=!0,this.UnlockNextCampaign(this.currentCampaign));const t=this.finalGrade.threshold>this.goodGradeThreshold;this.SaveGameState(),setTimeout((()=>this.CreateConfetti(t)),300)}},SetScale(){note("Set stage scale"),window.innerWidth<500?this.stageScale=window.innerWidth/500:this.stageScale=1},HandleAnnouncementClick(){note("Announcement clicked"),this.showAnnouncement=!1},HandleOkayButtonClick(){this.lock?this.finalGrade.threshold>this.goodGradeThreshold&&setTimeout((()=>{this.CreateConfetti(!0)}),200):this.EndGame()},HandleQuitButtonClick(){this.EndGame(),this.currentCampaign.isEndless||this.currentCampaign.isTutorial||(this.IsCampaignComplete(this.currentCampaign)?this.showCampaigns=!0:this.showSets=!0)},HandleNextButtonClick(){this.ResetTheater(),this.CompleteStageAndReadyNext()},async SelectDifficulty(e){note("Selected difficulty: "+e.name),this.difficulties.forEach((t=>{t.selected=!1})),e.selected=!0,this.trailHeight=e.height,this.trailWidth=e.width,this.puckHeight=e.height,this.puckWidth=e.width,await t.SaveData("difficulty",JSON.stringify(e)),this.speed=e.speed,this.currentDifficulty=e},async ToggleInstructions(){await t.SaveData("showInstructions",this.showInstructions)},GetHitsOn(t){let e=0;return this.results.forEach((s=>{s.success&&s.attempts==t&&e++})),e},GetMisses(){let t=0;return this.results.forEach((e=>{t+=e.deltas.length})),t},GetHighestPossibleScore(){let t=0;return this.currentSet.stages.forEach((e=>{t+=this.GetScoreForStage(e,!0)})),Math.round(t)},GetScoreForStage(t,e=!1){if(!t.finished)return 0;const s=e?1:t.attempts,i=(125e3-Number(t.th)*Number(t.tw)/2)/20,n=500-Number(t.ty),a=Number(t.difficulty.height)*Number(t.difficulty.width)/2,r=Math.max(1,(400-a)/200);let h=i+t.difficulty.speed+n;return h*=r,h/=10*s,h=Math.max(10,h),Math.round(h)},GetMissedByDirection(t){let e=0;return this.results.forEach((s=>{for(let i=0;i<s.deltas.length;i++){const n=s.deltas[i];n>0&&"below"==t&&e++,n<0&&"above"==t&&e++}})),0===this.GetMisses()?0:Math.round(e/this.GetMisses()*100)},ResetTheater(){this.showEndSet=!1,this.isPlaying=!0,this.isReady=!0,this.lock=!1,this.spaceBarCooldown=!1,this.showYesNo=!1,this.showSettings=!1,this.dropTotalCount=0,this.isStopped=!1,this.isDropping=!1,this.isPlaying=!1,this.showInstructions=!0},EndGame(){note("Ending game"),this.RemoveConfetti(),this.results.length>0&&4===this.results[this.results.length-1].attempts&&this.results.pop(),this.ResetTheater(),this.isPlaying=!1,this.isReady=!1,this.isStopped=!0,this.showHome=!0},HideAllModalsAndOverlays(){note("Hiding all modals and overlays"),this.showSettings=!1,this.showCampaigns=!1,this.showHome=!1,this.showSets=!1},HandleBackButtonClick(t){return note("Back button clicked"),t.stopPropagation(),t.preventDefault(),this.showSettings?(this.HideAllModalsAndOverlays(),void(this.showHome=!this.isPlaying)):this.showCampaigns?(this.HideAllModalsAndOverlays(),void(this.showHome=!0)):this.showSets?(this.HideAllModalsAndOverlays(),void(!this.currentCampaign||this.currentCampaign.isEndless||this.currentCampaign.isTutorial?this.showHome=!0:this.showCampaigns=!0)):void 0},HandleActionButton(t,e){if(t&&(t.stopPropagation(),t.preventDefault()),this.showYesNo&&"quit"===e)this.EndGame();else{if(this.isDropping&&"stop"===e)return this.StopPuck(),this.showInstructions=!1,this.isDropping=!1,void(this.isStopped=!0);if(!this.isStopped||"next"!==e)return this.isReady&&"drop"===e?(this.isReady=!1,this.isDropping=!0,void(this.currentStage&&!this.currentStage.finished&&this.dropCount++)):void 0;this.showEndSet&&!this.isLastSet&&this.currentCampaign&&!this.currentCampaign.finished?(this.ResetTheater(),this.CompleteStageAndReadyNext()):(this.CompleteStageAndReadyNext(),this.isStopped=!1,this.isReady=!0)}},HandlePuckColorButtonClick(t,e){t.stopPropagation(),t.preventDefault(),this.SetPuckColor(e)},async SetPuckColor(e){note("Set puck dark: "+e),this.useDarkPuck=e,this.r.style.setProperty("--puckLuminosity",(this.useDarkPuck?0:100)+"%"),await t.SaveData("useDarkPuck",e)},HandleThemeButton(t,e){t.stopPropagation(),t.preventDefault(),this.SelectGameTheme(e.name)},async SelectGameTheme(e){var s;note("Selecting theme: "+e),this.themes.forEach((t=>{t.selected=t.name==e,t.selected&&(s=t)})),null==s&&((s=this.themes[1]).selected=!0),this.r.style.setProperty("--hue",s.h),this.r.style.setProperty("--saturation",s.s+"%"),document.getElementById("themeColor").setAttribute("content","hsl("+s.h+", "+s.s+"%, 61%)"),await t.SaveData("theme",s.name)},UpdateApp(t){this.lastUpdate||(this.lastUpdate=t);const e=(t-this.lastUpdate)/1e3;this.lastUpdate=t,this.isDropping&&!this.puckHitBottom&&(this.puckY=Number(this.puckY)+this.speed*e)},RestartGame(t=null){note("Restarting game"),this.isSuccess=!1,this.lock=!1,this.results=[],this.dropCount=3,this.dropTotalCount=0,this.score=0,this.isDropping=!1,this.isStopped=!1,this.isReady=!0,this.isPlaying=!0,this.showHome=!1,this.showEndSet=!1,this.showCampaigns=!1,this.showSettings=!1,this.showYesNo=!1,this.showSets=!1,this.CompleteStageAndReadyNext()},StartCampaign(t){this.SelectCampaign(t),this.showCampaigns=!1,this.currentCampaign.isEndless?this.RestartGame(t):this.showSets=!0},SelectSet(t,e=!1){if(log("Select set: "+t.name),t.finished&&!e){if(!window.confirm("This set is already finished. Do you want to play it again?"))return}this.showAnnouncement=!0,this.currentCampaign.finished=!1,this.currentSet=t,this.currentSet.selected=!0,this.ClearSet(t),this.QueueSet(),this.RestartGame()},ClearSet(t){note("Clearing set: "+t.name),t.stages.forEach((t=>{t.success=!1,t.attempts=0,t.finished=!1,t.score=0,t.grade=null})),t.finished=!1,t.score=0,t.grade=null,t.locked=!1,this.results=[]},SelectCampaign(t){note("Select campaign: "+t.name),this.campaigns.forEach((t=>{t.selected=!1})),this.currentCampaign=t,this.currentCampaign.selected=!0,this.currentCampaign.isEndless||(this.difficulty=this.currentCampaign.difficulty)},ApplyDifficultyInheritance(){note("Applying difficulty inheritance"),this.campaigns.forEach((t=>t.sets.forEach((t=>t.stages.forEach((e=>{e.difficulty||(e.difficulty=t.difficulty)}))))))},IsSetComplete(t){const e=t.stages.every((t=>t.finished));return note("Set "+t.name+" complete: "+e),e},IsCampaignComplete(t){const e=t.sets.every((t=>this.IsSetComplete(t)));return note("Campaign "+t.name+" complete: "+e),e},IsGameComplete(){return this.campaigns.every((t=>this.IsCampaignComplete(t)))},UnlockNextSet(t,e){note("Unlocking next set in campaign: "+t.name+", current set: "+e.name);const s=t.sets,i=s.indexOf(e);return-1!==i&&i<s.length-1?(s[i+1].locked=!1,s[i+1]):(this.UpdateScores(),null)},UnlockNextCampaign(t){note("Unlocking next campaign after: "+t.name);const e=this.campaigns,s=e.indexOf(t);return-1!==s&&s<e.length-1?(e[s+1].locked=!1,e[s+1]):(this.UpdateScores(),null)},UpdateScores(){note("Updating scores for campaigns and sets"),this.campaigns.forEach((t=>{t.sets&&Array.isArray(t.sets)?(t.sets.forEach((t=>{t.stages&&Array.isArray(t.stages)?(t.stages.forEach((t=>{t.score=this.GetScoreForStage(t)})),t.score=t.stages.reduce(((t,e)=>t+(e.score||0)),0)):t.score=0})),t.score=t.sets.reduce(((t,e)=>t+(e.score||0)),0)):t.score=0}))},async GetSettings(){note("Get settings from localStorage");const e=["difficulty","theme","useDarkPuck"];for(const s of e){let e=localStorage.getItem(s);null!==e&&(await t.SaveData(s,e),localStorage.removeItem(s))}const s=await t.GetData("difficulty");if("string"==typeof s&&""!==s.trim()&&"undefined"!==s){var i=new t.DifficultyModel(JSON.parse(s));this.difficulties.forEach((t=>{t.name==i.name&&this.SelectDifficulty(t)}))}else this.SelectDifficulty(this.difficulties[0]);const n=await t.GetData("theme");"string"==typeof n&&""!==n.trim()&&"undefined"!==n?this.SelectGameTheme(n):this.SelectGameTheme(this.themes[3].name);const a=await t.GetData("useDarkPuck");"boolean"==typeof a?this.SetPuckColor(a):this.SetPuckColor(!1);const r=await t.GetData("hasUsedSpaceBar");this.hasUsedSpaceBar="useDarkPuck"==typeof r&&r},RemoveConfetti(){note("Remove confetti");const t=document.getElementsByTagName("confetti")[0];t&&(t.innerHTML="")},CreateConfetti(t=!1){note("Create confetti"),this.RemoveConfetti();let e=document.getElementsByTagName("confetti")[0],s=e.clientWidth;for(let i=0;i<s;i++){let s=document.createElement("confetto"),i=t?getRandomInt(66,84):getRandomInt(76,94);s.style.setProperty("left",getRandomInt(0,e.clientWidth)+(window.innerWidth-e.clientWidth)/2+"px"),s.style.setProperty("transition-duration",getRandomInt(1600,3001)+"ms"),s.style.setProperty("background-color","hsl("+(this.currentTheme.h+(t?180:0))+", "+(this.currentTheme.s+40)+"%, "+i+"%)"),s.style.setProperty("transition-delay",getRandomInt(0,800)+"ms"),s.style.setProperty("rotate",NaN);let n=getRandomInt(40,100)/10,a=getRandomInt(40,100)/10;s.style.setProperty("width",n+"px"),s.style.setProperty("height",a+"px"),e.appendChild(s)}window.setTimeout((function(){let t=document.getElementsByTagName("confetto");for(let e=0;e<t.length;e++){const s=t[e];s.style.setProperty("transform","translate("+parseInt(getRandomInt(-20,20))+"px, "+parseInt(document.body.clientHeight-s.clientHeight+20)+"px) rotate("+getRandomInt(-360,360)+"deg)"),s.className="drop"}}))},Share(){navigator.share({title:"Drop 'n Stop!",text:"The puck stops here.",url:"https://dropnstop.games"})},HandleKeyUp(t){let e;switch(this.themes.forEach(((t,s)=>{t.selected&&(e=s)})),t.code){case"ArrowRight":e=e==this.themes.length-1?0:e+1,null!=e&&e>=0&&this.SelectGameTheme(this.themes[e].name);break;case"ArrowLeft":e=0==e?this.themes.length-1:e-1,null!=e&&e>=0&&this.SelectGameTheme(this.themes[e].name);break;case"Enter":this.lock?this.HandleOkayButtonClick():this.showYesNo&&!this.showEndSet?this.EndGame():!this.showEndSet||this.showHome||this.showSettings||this.EndGame();break;case"Escape":this.lock||(this.showYesNo?this.showYesNo=!1:this.showSettings?this.showSettings=!1:this.showHome&&(this.showSettings=!0));break;case"Space":this.lock||(this.spaceBarInUse=!1,!this.isDropping||this.showEndSet||this.showHome||this.showSettings?this.spaceBarCooldown||!(this.isReady||this.isStopped&&!this.showEndSet)||this.showEndSet||this.showHome||this.showSettings||this.HandleActionButton(t,"next"):this.HandleActionButton(t,"stop"));break}},HandleKeyDown(e){if(this.showAnnouncement)this.HandleAnnouncementClick();else if(!this.lock)switch(e.code){case"Space":this.spaceBarCooldown||this.isDropping||!this.isReady||this.showEndSet||this.isStopped||this.showHome||this.showSettings||(this.spaceBarInUse=!0,this.hasUsedSpaceBar=!0,t.SaveData("hasUsedSpaceBar",!0),this.HandleActionButton(e,"drop"),this.spaceBarCooldown=!0,setTimeout((()=>{this.spaceBarCooldown=!1}),350));break}},HandleResize(){clearTimeout(this.resizeDebounceTimer),this.resizeDebounceTimer=setTimeout((()=>{note("Handling resize"),this.SetScale(),this.RemoveConfetti()}),100)},async SaveGameState(){note("Saving game state"),await t.SaveData("gameState",JSON.stringify({campaigns:this.campaigns}))},async GetGameState(){note("Restoring game state");const e=await t.GetData("gameState");if("string"==typeof e&&""!==e.trim()&&"undefined"!==e)try{const t=JSON.parse(e);t.campaigns&&(this.MergeCampaignProgress(this.campaigns,t.campaigns),this.currentCampaign=this.campaigns[0],this.currentSet=this.currentCampaign.sets?this.currentCampaign.sets[0]:null,this.currentStage=this.currentSet&&this.currentSet.stages?this.currentSet.stages[0]:null,note("Game state merged from IndexedDB"))}catch(t){}else note("No saved game state found")},MergeCampaignProgress(t,e){t.forEach((t=>{const s=e.find((e=>e.name===t.name));s&&(t.locked=s.locked,t.finished=s.finished,t.score=s.score,t.grade=s.grade,t.sets&&s.sets&&t.sets.forEach(((t,e)=>{const i=s.sets[e];i&&(t.locked=i.locked,t.finished=i.finished,t.score=i.score,t.grade=i.grade,t.stages&&i.stages&&t.stages.forEach(((t,e)=>{const s=i.stages[e];s&&(t.finished=s.finished,t.success=s.success,t.attempts=s.attempts,t.score=s.score,t.grade=s.grade)})))})))}))},async ClearAllData(){window.confirm("Are you sure you want to clear all game data? This will reset all scores and campaign locks.")&&(note("Clearing all game data"),this.campaigns.forEach(((t,e)=>{const s=t.isTutorial,i=t.isEndless,n=2===e;t.locked=!(s||i||n),t.finished=!1,t.score=0,t.grade=null,t.sets.forEach(((t,e)=>{const a=s||i||!s&&i&&n&&0===e;t.locked=!a,t.finished=!1,t.score=0,t.grade=null,t.stages.forEach((t=>{t.finished=!1,t.success=!1,t.attempts=0,t.score=0,t.grade=null}))}))})),this.EndGame(),this.HideAllModalsAndOverlays(),this.showHome=!0,await t.RemoveData("gameState"))}},async mounted(){this.isLoading=!0,this.stageElement=document.getElementsByTagName("stage")[0],this.puckElement=document.getElementsByTagName("puck")[0],window.addEventListener("keyup",this.HandleKeyUp),window.addEventListener("keydown",this.HandleKeyDown),window.addEventListener("resize",this.HandleResize),window.addEventListener("beforeunload",this.SaveGameState),this.SetScale(),this.GetSettings(),await this.GetGameState(),this.ApplyDifficultyInheritance();const t=e=>{this.UpdateApp(e),this._animationFrame=requestAnimationFrame(t)};this._animationFrame=requestAnimationFrame(t),this.isLoading=!1},beforeDestroy(){this.SaveGameState(),cancelAnimationFrame(this._animationFrame),window.removeEventListener("keyup",this.HandleKeyUp),window.removeEventListener("keydown",this.HandleKeyDown),window.removeEventListener("resize",this.HandleResize)},computed:{targetValue(){const t=this.isReady?this.dropCount+1:this.dropCount,e=(125e3-Number(this.targetHeight)*Number(this.targetWidth)/2)/20,s=500-Number(this.targetY),i=Number(this.puckHeight)*Number(this.puckWidth)/2,n=Math.max(1,(400-i)/200);let a=e+this.currentDifficulty.speed+s;return a*=n,a/=10*t,a=Math.max(10,a),Math.round(a)},hitsOnOne(){return 0===this.totalZonesClearedSucccessfully?0:Math.round(100*this.GetHitsOn(1)/this.results.length)+"%"},hitsOnTwo(){return 0===this.totalZonesClearedSucccessfully?0:Math.round(100*this.GetHitsOn(2)/this.results.length)+"%"},hitsOnThree(){return 0===this.totalZonesClearedSucccessfully?0:Math.round(100*this.GetHitsOn(3)/this.results.length)+"%"},totalZonesClearedSucccessfully(){return this.GetHitsOn(1)+this.GetHitsOn(2)+this.GetHitsOn(3)},misses(){return this.GetMisses()},highestPossibleScore(){return this.GetHighestPossibleScore()},missedAbove(){return this.GetMissedByDirection("above")+"%"},missedBelow(){return this.GetMissedByDirection("below")+"%"},userLocale:()=>navigator.language||"en-US",instructions(){return this.currentStage&&this.currentStage.description&&0===this.dropCount?this.currentStage.name?`${this.currentStage.name}<br /><span>${this.currentStage.description}</span>`:`<span>${this.currentStage.description}</span>`:""},announcement(){return this.currentSet&&this.currentSet.name&&0===this.dropCount?`${this.currentCampaign.name} — ${this.currentSet.name}<br /><span>${this.currentSet.description}</span>`:""},levelInfo(){return this.currentSet&&this.currentStage?`Level ${this.currentStageIndex+1} of ${this.currentSet.stages.length}`:""},puckHitBottom(){if(!this.isDropping)return!1;let t=this.stageElement.getBoundingClientRect();const e=this.stageScale||1,s=t.height/e;return this.puckY+this.puckHeight>=s-2},isChromeAndiOSoriPadOS(){var t=navigator.userAgent||window.opera,e=/CriOS/.test(t)||/iPhone|iPad|iPod/.test(t),s=/Firefox/.test(t)&&/Android/.test(t);return e||s},currentTheme(){let t=this.themes.find((t=>t.selected));return void 0===t&&(t=this.themes[1],t.selected=!0),t},isFirstRun(){return!this.isDropping&&0===this.dropTotalCount&&this.currentCampaign&&this.currentCampaign.isTutorial},percentScored(){return this.score/this.highestPossibleScore},percentOfHitsIn1Drop(){return Math.round(100*this.GetHitsOn(0)/this.results.length)},finalScore(){let t=(this.startingDropCount-this.misses)/this.startingDropCount;return(this.percentScored+t)/2*100},finalGrade(){let t=this.totalZonesClearedSucccessfully/this.results.length,e=(this.startingDropCount-this.misses)/this.startingDropCount,s=(this.percentScored+t+e)/3,i=100*(s>this.percentScored?s:this.percentScored);return this.grades.find((t=>i>=t.threshold))||this.grades[this.grades.length-1]},thisYear:()=>(new Date).getFullYear(),currentStageIndex(){return this.currentSet?this.currentSet.stages.indexOf(this.currentStage):-1},isLastSet(){return!!this.currentCampaign&&this.currentCampaign.sets.indexOf(this.currentSet)===this.currentCampaign.sets.length-1},isFirstSetAndFirstStage(){return this.currentCampaign&&this.currentCampaign.sets.length>0&&this.currentSet&&this.currentSet.stages.length>0&&0===this.currentCampaign.sets.indexOf(this.currentSet)&&0===this.currentSet.stages.indexOf(this.currentStage)},isFirstStageOfSet(){return this.currentSet&&this.currentSet.stages.length>0&&0===this.currentSet.stages.indexOf(this.currentStage)},nextSet(){return this.UnlockNextSet(this.currentCampaign,this.currentSet)},nextCampaign(){return this.UnlockNextCampaign(this.currentCampaign)},fontScale(){return""+1/this.stageScale}}})}));const a=window.app;